---
title:    "TDS10 Final Project"
author:   
- "Aleksandrov Boyan, 320961, b.aleksandrov@studenti.luiss.it"
- "Nishtelkova Maria"

abstract: "IF you wish, you may add here a short abstract of 100 words max."
date:     "Last compiled on:   `r format(Sys.time(), '%d %B, %Y')`"
output:   pdf_document
fontsize: 12pt
header-includes:
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{lmodern}
  \usepackage{lipsum}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \renewcommand{\headrulewidth}{0pt}
  \fancyhf{}
  \fancyfoot[C]{\twopagenumbers}
  \fancypagestyle{plain}{
    \renewcommand{\headrulewidth}{0pt}
    \fancyhf{}
    \fancyfoot[C]{\twopagenumbers}
  }
  \usepackage[user]{zref}
  \newcounter{pageaux}
  \def\currentauxref{PAGEAUX1}
  \newcommand{\twopagenumbers}{
    \stepcounter{pageaux}
    \thepageaux\, of\, \ref{\currentauxref}
  }
  \makeatletter
  \newcommand{\resetpageaux}{
    \clearpage
    \edef\@currentlabel{\thepageaux}\label{\currentauxref}
    \xdef\currentauxref{PAGEAUX\thepage}
    \setcounter{pageaux}{0}}
  \AtEndDvi{\edef\@currentlabel{\thepageaux}\label{\currentauxref}}
  \makeatletter
---

# Introduction

"adsadsds"
Before establishing the multinomial logistic regression model, we looked at some of the predictors' visual variations over the response variable hdc's various levels. This enables us to recognise potential patterns and comprehend which factors might be helpful in predicting the seriousness of heart disease.

To investigate numerical factors like cholesterol, resting blood pressure, maximal heart rate, and ST depression, we employed boxplots. These charts illustrate the variations in these variables' distributions among the various categories of heart disease.

To determine how the frequency of each category varies throughout the hdc levels, we made barplots for categorical variables including the type of chest discomfort and the resting ECG result.

An introductory comprehension of the connections between predictors and the response variable is provided by this visual investigation.

9999999

After cholesterol boxplot:
From the boxplot, cholesterol tends to be higher in some of the higher heart disease categories, although the variability overlaps across groups.

After trestbps boxplot:
Blood pressure appears to increase slightly for patients with higher heart disease categories, but the differences are not very clear.

After cp vs hdc barplot:
Certain chest pain types appear more often in higher heart disease categories, suggesting that chest pain type may be a useful predictor.

After restecg vs hdc barplot:
Some Rest ECG categories show different frequencies across hdc levels, indicating a possible relationship.


hist
Histograms show the distribution of the numeric variables. Some variables are skewed (especially oldpeak), and the plots help us understand the data before modeling.

# Dataset Description

(Write about heart.csv here)


# Multinomial Logistic Regression â€” Theory

Question(1.1):

We are using multinomial Logistic Regression because the response variable can take more than 2 categories.
For these categories there is a separate set of coefficients and we choose one as the baseline. The coefficients
describe how the predictors(age, sex, chol etc.) affect the probability of belonging to each outcome category.

In this regression the response variable Y can take K-number of different categories.
We have to pick one of the categories to be the baseline - category 0, for every other category - k = 1,2...,K-1.

The model shows the probability of an observation belonging to category K using the multinomial logistic regression function:

$$
P(Y = k \mid X) =
\frac{\exp(\beta_{0k} + \beta_k^T X)}
     {1 + \sum_{j=1}^{K-1} \exp(\beta_{0j} + \beta_j^T X)}
$$

The probability of the baseline category is:

$$
P(Y = 0 \mid X) =
\frac{1}
     {1 + \sum_{j=1}^{K-1} \exp(\beta_{0j} + \beta_j^T X)}
$$


# Data Preparation 

There are several variables in the dataset containing missing values.In order to prepare the data for the multinomial logistic model,we observed how many missing values each variable had and saw that the variables ca, thal, and slope had extremely high numbers of missing values. Because these variables are categorical, and because imputing such a large amount of missing data would introduce strong bias, we decided to remove them from the dataset.
For the remaining numeric variables with less missing values- (trestbps, chol, thalach, oldpeak) we applied median imputation.

We chose this method because replacing each missing value with the median of the corresponding variable is a robust measure that is not affected by extreme values. 

For the categorial variables with very few missing values, we replaced missing entries with the most frequent category (the mode).

This approach ensures that there are no missing values before using the multinomial logistic regression model.

```{r, echo=FALSE}

heartData <- read.csv("heart.csv")

heartData$place   <- as.factor(heartData[["place"]])
heartData$cp      <- as.factor(heartData[["cp"]])


heartData$hdc     <- as.factor(heartData[["hdc"]])

heartData$restecg <- as.factor(heartData[["restecg"]])

heartData$sex   <- ifelse(heartData[["sex"]] == "Male", 1, 0)
heartData$fbs   <- ifelse(heartData[["fbs"]] == TRUE, 1, 0)
heartData$exang <- ifelse(heartData[["exang"]] == TRUE, 1, 0)

heartData$trestbps[is.na(heartData$trestbps)] <- median(heartData$trestbps, na.rm = TRUE)
heartData$chol[is.na(heartData$chol)] <- median(heartData$chol, na.rm = TRUE)
heartData$thalch[is.na(heartData$thalch)] <- median(heartData$thalch, na.rm = TRUE)
heartData$oldpeak[is.na(heartData$oldpeak)] <- median(heartData$oldpeak, na.rm = TRUE)
heartData$ca <- NULL
heartData$thal <- NULL
heartData$slope <- NULL


mostCommon_restecg <- names(sort(table(heartData$restecg), decreasing = TRUE))[1]
heartData$restecg[is.na(heartData$restecg)] <- mostCommon_restecg

mostCommon_fbs <- names(sort(table(heartData$fbs), decreasing = TRUE))[1]
heartData$fbs[is.na(heartData$fbs)] <- mostCommon_fbs

mostCommon_exang <- names(sort(table(heartData$exang), decreasing = TRUE))[1]
heartData$exang[is.na(heartData$exang)] <- mostCommon_exang


colSums(is.na(heartData))
head(heartData)

```


# Exploratory Data Analysis

```{r, echo=FALSE}
install.packages("ggplot2")
library(ggplot2)
ggplot(heartData, aes(x = factor(hdc), y = chol, fill = factor(hdc))) +
  geom_boxplot(alpha = 0.7) +
  labs(x = "HDC", y = "Cholesterol",
       title = "Cholesterol levels across heart disease categories") +
  theme_minimal() +
  theme(legend.position = "none")

ggplot(heartData, aes(x = factor(hdc), y = trestbps, fill = factor(hdc))) +
  geom_boxplot(alpha = 0.7) +
  labs(x = "HDC", y = "Resting Blood Pressure",
       title = "Resting blood pressure across heart disease categories") +
  theme_minimal() +
  theme(legend.position = "none")


ggplot(heartData, aes(x = factor(hdc), y = thalch, fill = factor(hdc))) +
  geom_boxplot(alpha = 0.7) +
  labs(x = "HDC", y = "Maximum heart level",
       title = "Maximum heart level across heart disease categories") +
  theme_minimal() +
  theme(legend.position = "none")

ggplot(heartData, aes(x = cp, fill = factor(hdc))) +
  geom_bar(position = "fill") +
  labs(x = "Chest Pain Type",
       y = "Proportion",
       title = "Proportion of heart disease category by chest pain type",
       fill = "hdc") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()

ggplot(heartData, aes(x = restecg, fill = factor(hdc))) +
  geom_bar(position = "fill") +
  labs(x = "Resting ECG Type",
       y = "Proportion",
       title = "Proportion of heart disease category by resting ECG",
       fill = "hdc") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()

ggplot(heartData, aes(x = age, fill = factor(hdc))) +
  geom_histogram(alpha = 0.7, position = "identity", bins = 40) +
  labs(
    x = "Age",
    y = "Count",
    fill = "HDC",
    title = "Distribution of age across HDC"
  ) +
  theme_minimal()

```
Distribution of age across HDC
Patients with higher heart disease categories tend to be older, with the age distribution shifting toward later decades as HDC increases.

Cholesterol levels across heart disease categories
Cholesterol levels appear broadly similar across categories, though higher HDC groups show slightly more variability.

 Resting blood pressure across heart disease categories
Resting blood pressure shows a mild increasing trend with higher HDC, but overall differences between groups are modest.

 Maximum heart rate across heart disease categories
Patients with higher HDC values generally demonstrate lower maximum heart rates compared to those without heart disease.

 Proportion of heart disease category by chest pain type
Atypical and non-anginal chest pain types contain a higher proportion of severe heart disease cases compared to typical angina.

 Proportion of heart disease category by resting ECG type
ST-T abnormalities and LV hypertrophy are associated with a greater share of higher heart disease categories compared to normal ECG results.

# Multinomial Logistic Regression

(Fit model + interpretation)

# Model Evaluation

(Cross-validation)

# Model Improvement

(Stepwise model / alternative model)

# Binary Logistic Regression

(Create hdc01 + logistic model)

# Model Comparison

(Compare multinomial vs binary)

# Conclusion

(Brief summary)

